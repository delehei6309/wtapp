"use strict";(self.webpackChunkhro_client=self.webpackChunkhro_client||[]).push([[579],{5579:(e,t,a)=>{a.r(t),a.d(t,{Component:()=>k});var i=a(9867),l=a(3442),n=a(766),s=a(8605),o=a(9415),c=a(4670),r=a(9490),d=a(5413),u=a(9395),f=a(6441),_=a(2689),p=a(2834);function m(e){let{unique_file_name:t,bucket_name:a,auto_size:l}=e;const[s,o]=(0,i.useState)("");return(0,i.useEffect)((()=>{t&&(async()=>{const e=await(0,r.Zz)(t,a);o(e)})()}),[t]),(0,p.jsx)(n.Z,{component:"img",sx:{width:"100%",height:"100%",...l?{objectFit:"contain"}:{}},src:s})}const y=e=>{let{data:t,values:a}=e;return t?1===t.field_type?t.field_specs.date_format?a[t.field_key]?(0,r.p6)((0,u.Z)(a[t.field_key])?a[t.field_key]:new Date(a[t.field_key]),t.field_specs.date_format):"":a[t.field_key]||t.field_name:2===t.field_type?(0,p.jsx)(f.ac,{data:t,rows:a[t.field_key]}):3===t.field_type?a[t.field_key]?(0,p.jsx)(m,{unique_file_name:(null===(i=a[t.field_key])||void 0===i?void 0:i.unique_file_name)||a[t.field_key],bucket_name:null===(l=a[t.field_key])||void 0===l?void 0:l.bucket_name,auto_size:t.field_specs.auto_size}):t.field_key:void 0:null;var i,l};function h(e){let{src:t,template_params:a,fillValues:l}=e;const s=(0,_.Z)(),o=(0,i.useRef)(null),[c,r]=(0,i.useState)(0);return(0,i.useEffect)((()=>{o.current&&r(Math.floor(o.current.getBoundingClientRect().height-1))}),[o.current]),(0,p.jsxs)(n.Z,{fontSize:0,ref:o,position:"relative",sx:{...0===c?{}:{height:"".concat(c,"px")}},children:[(0,p.jsx)("img",{src:t}),a.map(((e,t)=>(0,p.jsx)(n.Z,{position:"absolute",zIndex:7,height:e.field_specs.height,left:100*e.field_specs.x_coordinate+"%",top:100*e.field_specs.y_coordinate+"%",fontSize:e.field_specs.font_size,alignItems:"center",sx:2===e.field_type?{width:"100%",display:"block",bgcolor:s.palette.background.paper,border:"1px solid ".concat(s.palette.divider),thead:{bgcolor:s.palette.background.default}}:{width:e.field_specs.width,display:"flex",bgcolor:"transparent"},children:(0,p.jsx)(y,{data:e,values:l})},t)))]})}const g=e=>{let{template:t,values:a}=e;const l=(0,o.d)(),[n,s]=(0,i.useState)([]);return(0,i.useEffect)((()=>{(async()=>{var e,a;const i=await(0,r.Zz)(null===(e=t.template_info)||void 0===e?void 0:e.unique_file_name,null===(a=t.template_info)||void 0===a?void 0:a.bucket_name);if(i){const e=await(0,d.Z)(i,3,!0);s(e)}l.setLoading(!1)})()}),[]),(0,p.jsx)(i.Fragment,{children:n.map(((e,i)=>(0,p.jsx)(h,{src:e,template_params:t.template_params.filter((e=>{let{field_specs:t}=e;return t.current_page===i+1})),fillValues:a},i)))})},v=e=>{let{template:t,values:a}=e;const l=(0,i.useRef)(null);return(0,i.useEffect)((()=>{(async()=>{await(0,r.Ql)();l.current.querySelectorAll(".custom-insert-element").forEach((e=>{const t=(0,r.SH)(e.getAttribute("data-params")),i=JSON.parse(t);if(i){const{field_key:t,field_type:n,field_specs:s,field_name:o}=i,c=null===a||void 0===a?void 0:a[t];if(c){if(1===n)if(e.classList.remove("custom-text-element"),null!==s&&void 0!==s&&s.date_format)try{e.innerHTML=(0,r.p6)((0,u.Z)(c)?c:new Date(c),s.date_format)}catch(l){e.innerHTML=c}else e.innerHTML=c;if(2===n&&"TABLE"===e.tagName){console.log("field_specs",e);const t=c.map((e=>"<tr>\n                                    ".concat(s.columns.map((t=>'<td align="center">'.concat(e[t.field_key]||"--","</td>"))).join(""),"\n                                </tr>"))).join("").replace(/>\s+</g,"><");e.querySelector("tbody").innerHTML=t}3===n&&(0,r.Zz)((null===c||void 0===c?void 0:c.unique_file_name)||c,null===c||void 0===c?void 0:c.bucket_name).then((t=>{e.src=t,null!==s&&void 0!==s&&s.auto_size&&(e.style.objectFit="contain")})),e.removeAttribute("data-params")}}}));l.current.querySelectorAll(".custom-sign-element").forEach((e=>{e.style.visibility="hidden"})),l.current.querySelectorAll(".insert-local-image").forEach((async e=>{const t=(0,r.SH)(e.getAttribute("data-params")),a=JSON.parse(t);(0,r.Zz)(a.unique_file_name,a.bucket_name).then((t=>{e.src=t}))}))})()}),[l]),(0,p.jsx)(n.Z,{dangerouslySetInnerHTML:{__html:t.template_info.html_info},ref:l,sx:{img:{maxWidth:"100%"}},className:"jodit-wysiwyg"})},k=()=>{const e=(0,o.d)(),{template_id:t,key:a,user_id:r}=(0,c.UO)(),[d,u]=(0,i.useState)({}),[f,_]=(0,i.useState)({});return(0,i.useEffect)((()=>{(async()=>{e.setLoading(!0);const[i,l]=await function(){for(var e=arguments.length,t=new Array(e),a=0;a<e;a++)t[a]=arguments[a];return Promise.all(t)}((async(e,t)=>await(0,s.Ab)("/xbd/tpl/users/".concat(e,"/templates/").concat(t)))(r,t),(async(e,t,a)=>await(0,s.Ab)("/xbd/tpl/users/".concat(e,"/templates/").concat(t,"/keys/").concat(a)))(r,t,a));i&&l?(2===i.template_type&&e.setLoading(!1),u(i),_(l)):e.setLoading(!1)})()}),[]),(0,p.jsxs)(n.Z,{margin:"0 auto",width:l.gv,sx:1===d.template_type?{img:{width:"100%"}}:{},id:"html-to-pdf",children:[1===d.template_type?(0,p.jsx)(g,{template:d,values:f}):null,2===(null===d||void 0===d?void 0:d.template_type)?(0,p.jsx)(v,{template:d,values:f}):null]})}}}]);
//# sourceMappingURL=579.7421b442.chunk.js.map